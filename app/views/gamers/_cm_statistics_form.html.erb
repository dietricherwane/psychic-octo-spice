<div class="widget">
  <div class="title"><img src="<%= asset_path 'icons/dark/full2.png' %>" alt="" class="titleIcon" /><h6>Statistiques relatives au PMU ALR</h6></div>
  <table cellpadding="0" cellspacing="0" border="0" class="display dTable taskWidget">
    <thead>
      <tr>
        <th>Statut</th>
        <th>Nombre de paris</th>
        <th>Chiffre d'affaires</th>
        <th>Montant des annulations</th>
        <th>Montant des gains</th>
      </tr>
    </thead>
    <tbody>
      <tr class="gradeA">
        <td class = "taskP">
          En cours
        </td>
        <td>
          <% on_hold_count = @cm_bets.where("bet_status = 'En cours'").count %>
          <%= number_with_delimiter(on_hold_count) %>
        </td>
        <td>
          <% on_hold_amount = @cm_bets.where("bet_status = 'En cours'").map{|bet| (bet.amount.to_f rescue 0)}.sum %>
          <%= number_with_delimiter(on_hold_amount) %>
        </td>
        <td>

        </td>
        <td>

        </td>
      </tr>
      <tr class="gradeA">
        <td class = "taskD">
          Annulé
        </td>
        <td>
          <% cancelled_count = @cm_bets.where("bet_status = 'Annulé'").count %>
          <%= number_with_delimiter(cancelled_count) %>
        </td>
        <td>

        </td>
        <td>
          <% cancelled_amount = @cm_bets.where("bet_status = 'Annulé'").map{|bet| (bet.amount.to_f rescue 0)}.sum %>
          <%= number_with_delimiter(cancelled_amount) %>
        </td>
        <td>

        </td>
      </tr>
      <tr class="gradeA">

        <td class = "taskD">
          Perdant
        </td>
        <td>
          <% loosers_count = @cm_bets.where("bet_status = 'Perdant'").count %>
          <%= number_with_delimiter(loosers_count) %>
        </td>
        <td>
          <% loosers_amount = @cm_bets.where("bet_status = 'Perdant'").map{|bet| (bet.amount.to_f rescue 0)}.sum %>
          <%= number_with_delimiter(loosers_amount) %>
        </td>
        <td>

        </td>
        <td>

        </td>
      </tr>
      <tr class="gradeA">
        <td class = "taskPr">
          Gagnant
        </td>
        <td>
          <% winners_count = @cm_bets.where("bet_status = 'Gagnant'").count %>
          <%= number_with_delimiter(winners_count) %>
        </td>
        <td>
          <% winners_amount = @cm_bets.where("bet_status = 'Gagnant'").map{|bet| (bet.amount.to_f rescue 0)}.sum %>
          <%= number_with_delimiter(winners_amount) %>
        </td>
        <td>

        </td>
        <td>
          <% win_amount = @cm_bets.where("bet_status = 'Gagnant'").map{|bet| (bet.win_amount.to_f rescue 0)}.sum %>
          <%= number_with_delimiter(win_amount) %>
        </td>
      </tr>
      <tr class="gradeA">
        <td class = "taskPr">
          Remboursé
        </td>
        <td>
          <% refunds_count = @cm_bets.where("bet_status = 'Remboursé'").count %>
          <%= number_with_delimiter(refunds_count) %>
        </td>
        <td>
          <% refunds_amount = @cm_bets.where("bet_status = 'Remboursé'").map{|bet| (bet.amount.to_f rescue 0)}.sum %>
          <%= number_with_delimiter(refunds_amount) %>
        </td>
        <td>

        </td>
        <td>
          <%# win_amount = @cm_bets.where("bet_status = 'Remboursé'").map{|bet| (bet.win_amount.to_f rescue 0)}.sum %>
          <%= number_with_delimiter(refunds_amount) %>
        </td>
      </tr>
      <tr class="gradeA">
        <td>
          <b>Total</b>
        </td>
        <td>
          <b><%= number_with_delimiter(winners_count + loosers_count + cancelled_count + on_hold_count + refunds_count) %></b>
        </td>
        <td>
          <b><%= number_with_delimiter(winners_amount + loosers_amount + on_hold_amount + refunds_amount) %></b>
        </td>
        <td>
          <b><%= number_with_delimiter(cancelled_amount) %></b>
        </td>
        <td>
          <b><%= number_with_delimiter(win_amount) %></b>
        </td>
      </tr>
    </tbody>
  </table>
</div>
